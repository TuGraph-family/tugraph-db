<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-4-5-1_en docs-version-current docs-doc-page docs-doc-id-installation&running/high-availability-mode" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">High Availability mode | TuGraph 文档中心</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tugraph.tech/tugraph-db/en-US/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tugraph.tech/tugraph-db/en-US/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tugraph.tech/tugraph-db/en-US/en/4.5.1/installation&amp;running/high-availability-mode"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en-US"><meta data-rh="true" name="docsearch:language" content="en-US"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-4-5-1_en-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-4-5-1_en-current"><meta data-rh="true" property="og:title" content="High Availability mode | TuGraph 文档中心"><meta data-rh="true" name="description" content="This document describes the principles, preparations, and server operations of the high availability mode"><meta data-rh="true" property="og:description" content="This document describes the principles, preparations, and server operations of the high availability mode"><link data-rh="true" rel="icon" href="https://mdn.alipayobjects.com/huamei_qcdryc/afts/img/A*AbamQ5lxv0IAAAAAAAAAAAAADgOBAQ/original"><link data-rh="true" rel="canonical" href="https://tugraph.tech/tugraph-db/en-US/en/4.5.1/installation&amp;running/high-availability-mode"><link data-rh="true" rel="alternate" href="https://tugraph.tech/tugraph-db/en/4.5.1/installation&amp;running/high-availability-mode" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://tugraph.tech/tugraph-db/en-US/en/4.5.1/installation&amp;running/high-availability-mode" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://tugraph.tech/tugraph-db/en/4.5.1/installation&amp;running/high-availability-mode" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DGYVABHR0M-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="TuGraph 文档中心" href="/tugraph-db/en-US/opensearch.xml">

















<meta name="algolia-site-verification" content="FC204AA054194DE3"><link rel="stylesheet" href="/tugraph-db/en-US/assets/css/styles.ce6a6631.css">
<script src="/tugraph-db/en-US/assets/js/runtime~main.38cb1eaf.js" defer="defer"></script>
<script src="/tugraph-db/en-US/assets/js/main.16003d39.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tugraph-db/en-US/"><div class="navbar__logo"><img src="https://mdn.alipayobjects.com/huamei_qcdryc/afts/img/A*AbamQ5lxv0IAAAAAAAAAAAAADgOBAQ/original" alt="Tugraph Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://mdn.alipayobjects.com/huamei_qcdryc/afts/img/A*AbamQ5lxv0IAAAAAAAAAAAAADgOBAQ/original" alt="Tugraph Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/TuGraph-family/tugraph-db" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="docsearch-wrapper" style="display:flex;justify-content:center;flex-direction:column"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div class="itemWrapper"><div class="titleBlock"><span class="titleText">TuGraph DB</span><div class="downIcon"></div></div><div class="contentArea"><span id="engineDescription">Community</span><span class="versionLabel">V<!-- -->4.5.1</span></div></div><div class="searchWrapper"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tugraph-db/en-US/en/4.5.1/guide">Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/introduction/what-is-graph">introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/quick-start/preparation">quick-start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/user-guide/tugraph-browser">user-guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/environment">installation&amp;running</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/environment">Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/environment-mode">Environment Mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/docker-deployment">Docker Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/local-package-deployment">Local Package Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/cloud-deployment">Cloud Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/compile">Compile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/tugraph-running">Tugraph Running</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/high-availability-mode">High Availability mode</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/utility-tools/data-import">utility-tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/client-tools/python-client">client-tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/query/cypher">query</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/olap&amp;procedure/procedure">olap&amp;procedure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/permission/privilege">permission</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/quality/unit-testing">quality</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/contributor-manual/contributing">contributor-manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en-US/en/4.5.1/best-practices/rdbms-to-tugraph">best-practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tugraph-db/en-US/en/4.5.1/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tugraph-db/en-US/en/4.5.1/contacts">Contacts</a></li></ul></nav></div></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/tugraph-db/en-US/en/guide"><div style="color:#1a1b2572">Docs</div></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">installation&amp;running</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">High Availability mode</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>High Availability mode</h1></header>
<blockquote>
<p>This document describes the principles, preparations, and server operations of the high availability mode</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1theory">1.Theory<a href="#1theory" class="hash-link" aria-label="Direct link to 1.Theory" title="Direct link to 1.Theory">​</a></h2>
<p>TuGraph provides high availability (HA) mode through multi-machine hot backup. In high availability mode, write operations to the database will be synchronized to all servers (non-witness), so that even if some servers are down, the availability of the service will not be affected.</p>
<p>When the high-availability mode is started, multiple TuGraph servers form a backup group, which is a high-availability cluster. Each backup group consists of three or more TuGraph servers, one of which serves as the <code>leader</code> and the other replication group servers as <code>followers</code>. Write requests are served by a <code>leader</code>, which replicates and synchronizes each request to a <code>follower</code> and can only respond to the client after the request has been synchronized to the server. This way, if any server fails, the other servers will still have all the data written so far. If the <code>leader</code> server fails, other servers will automatically select a new <code>leader</code>.</p>
<p>TuGraph&#x27;s high-availability mode provides two types of nodes: <code>replica</code> nodes and <code>witness</code> nodes. Among them, the <code>replica</code> node is an ordinary node, has logs and data, and can provide services to the outside world. The <code>witness</code> node is a node that only receives heartbeats and logs but does not save data. According to deployment requirements, <code>leader</code> nodes and <code>follower</code> nodes can be flexibly deployed as <code>replica</code> nodes or <code>witness</code> nodes. Based on this, there are two deployment methods for TuGraph high-availability mode: one is the ordinary deployment mode, and the other is the simple deployment mode with witness.</p>
<p>For normal deployment mode, <code>leader</code> and all <code>followers</code> are nodes of type <code>replica</code>. Write requests are served by a <code>leader</code>, which copies each request to a <code>follower</code> and cannot respond to the client until the request has been synchronized to more than half of the servers. This way, if less than half of the servers fail, the other servers will still have all the data written so far. If the <code>leader</code> server fails, other servers will automatically elect a new <code>leader</code> to ensure data consistency and service availability.</p>
<p>However, when the user server resources are insufficient or a network partition occurs, a normal HA cluster cannot be established. At this time, since the <code>witness</code> node has no data and takes up little resources, the <code>witness</code> node and the <code>replica</code> node can be deployed on one machine. For example, when there are only 2 machines, you can deploy the <code>replica</code> node on one machine, and the <code>replica</code> node and <code>witness</code> node on another machine, which not only saves resources, but also does not require log application To the state machine, there is no need to generate and install snapshots, so the response to requests is very fast, and it can help quickly elect a new leader when the cluster crashes or the network is partitioned. This is the simple deployment mode of the TuGraph HA cluster. Although <code>witness</code> nodes have many benefits, since there is no data, the cluster actually adds a node that cannot become <code>leader</code>, so the availability will be slightly reduced. To improve the availability of the cluster, you can allow the <code>witness</code> node to be the leader temporarily by specifying the <code>ha_enable_witness_to_leader</code> parameter as <code>true</code>. After the <code>witness</code> node synchronizes the new log to other nodes, it will actively switch the leader role to the node with the latest log.</p>
<p>This feature is supported in version 3.6 and above.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2preparation">2.Preparation<a href="#2preparation" class="hash-link" aria-label="Direct link to 2.Preparation" title="Direct link to 2.Preparation">​</a></h2>
<p>To enable high availability mode, users need to:</p>
<ul>
<li>Three or more instances of TuGraph servers.</li>
<li>To enable high availability mode when starting lgraph_server, the &#x27;enable_ha&#x27; option can be set to &#x27;true&#x27; using a configuration file or the command line.</li>
<li>Set the correct rpc_port through the configuration file or command line</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3start-the-initial-backup-group">3.Start the initial backup group<a href="#3start-the-initial-backup-group" class="hash-link" aria-label="Direct link to 3.Start the initial backup group" title="Direct link to 3.Start the initial backup group">​</a></h2>
<p>After installing TuGraph, you can use the <code>lgraph_server</code> command to start a high-availability cluster on different machines. This section mainly explains how to start a high-availability cluster. For cluster status management after startup, see <a href="/tugraph-db/en-US/en/4.5.1/utility-tools/ha-cluster-management">lgraph_peer tool</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31the-initial-data-is-consistent">3.1.The initial data is consistent<a href="#31the-initial-data-is-consistent" class="hash-link" aria-label="Direct link to 3.1.The initial data is consistent" title="Direct link to 3.1.The initial data is consistent">​</a></h3>
<p>When the data in all servers is the same or there is no data at startup, the user can
specify <code>--ha_conf host1:port1,host2:port2</code> to start the server.
In this way, all prepared TuGraph instances can be added to the initial backup group at one time,
All servers in the backup group elect <code>leader</code> according to the RAFT protocol, and other
servers join the backup group with the role of <code>follower</code>.</p>
<p>An example command to start an initial backup group is as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After the first server is started, it will elect itself as the &#x27;leader&#x27; and organize a backup group with only itself.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32inconsistent-initial-data">3.2.Inconsistent initial data<a href="#32inconsistent-initial-data" class="hash-link" aria-label="Direct link to 3.2.Inconsistent initial data" title="Direct link to 3.2.Inconsistent initial data">​</a></h3>
<p>If there is already data in the first server (imported by the <code>lgraph_import</code> tool or transferred from a server in non-high availability mode),
And it has not been used in high-availability mode before, the user should use the boostrap method to start. Start the server with data in bootstrap
mode with the <code>ha_bootstrap_role</code> parameter as 1, and specify the machine as the <code>leader</code> through the <code>ha_conf</code>
parameter. In bootstrap mode, the server will copy its own data to the new server before adding the newly
joined server to the backup group, so that the data in each server is consistent.</p>
<p>An example command to start a data server is as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090 --ha_bootstrap_role 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Other servers without data need to specify the <code>ha_bootstrap_role</code> parameter as 2, and specify the <code>leader</code> through the <code>ha_conf</code> parameter. The command example is as follows</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">**$ ./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090 --ha_bootstrap_role 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>You need to pay attention to two points when using bootstrap to start an HA cluster:</strong></p>
<ol>
<li>You need to wait for the <code>leader</code> node to generate a snapshot and start successfully before joining the <code>follower</code> node, otherwise the <code>follower</code> node may fail to join. When starting the <code>follower</code> node, you can configure the <code>ha_node_join_group_s</code> parameter to be slightly larger to allow multiple waits and timeout retries when joining the HA cluster.</li>
<li>The HA cluster can only use the bootstrap mode when it is started for the first time. It can only be started in the normal mode (see Section 3.1) when it is started later. In particular, multiple nodes of the same cluster cannot be started in the bootstrap mode, otherwise it may cause Data inconsistency</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4start-witness-node">4.Start witness node<a href="#4start-witness-node" class="hash-link" aria-label="Direct link to 4.Start witness node" title="Direct link to 4.Start witness node">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-witness-nodes-are-not-allowed-to-become-leader">4.1. Witness nodes are not allowed to become leader<a href="#41-witness-nodes-are-not-allowed-to-become-leader" class="hash-link" aria-label="Direct link to 4.1. Witness nodes are not allowed to become leader" title="Direct link to 4.1. Witness nodes are not allowed to become leader">​</a></h3>
<p>The startup method of <code>witness</code> node is the same as that of ordinary nodes. You only need to set the <code>ha_is_witness</code> parameter to <code>true</code>. Note that the number of witness nodes should be less than half of the total number of cluster nodes.</p>
<p>An example command to start the witness node server is as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090 --ha_is_witness 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note: By default, the <code>witness</code> node is not allowed to become the <code>leader</code> node, which can improve the performance of the cluster, but will reduce the availability of the cluster when the <code>leader</code> node crashes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-allow-witness-nodes-to-become-leaders">4.1. Allow witness nodes to become leaders<a href="#41-allow-witness-nodes-to-become-leaders" class="hash-link" aria-label="Direct link to 4.1. Allow witness nodes to become leaders" title="Direct link to 4.1. Allow witness nodes to become leaders">​</a></h3>
<p>You can specify the <code>ha_enable_witness_to_leader</code> parameter as <code>true</code>, so that the <code>witness</code> node can temporarily become the <code>leader</code> node, and then actively switch to the master after the new log synchronization is completed.</p>
<p>An example of the command to start the <code>witness</code> node server that is allowed to become the <code>leader</code> node is as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090 --ha_is_witness 1 --ha_enable_witness_to_leader 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note: Although allowing <code>witness</code> nodes to become <code>leader</code> nodes can improve the availability of the cluster, it may affect data consistency in extreme cases. Therefore, it should generally be ensured that the number of <code>witness</code> nodes + 1 is less than half of the total number of cluster nodes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5scale-out-other-servers">5.Scale out other servers<a href="#5scale-out-other-servers" class="hash-link" aria-label="Direct link to 5.Scale out other servers" title="Direct link to 5.Scale out other servers">​</a></h2>
<p>After starting the initial backup group, if you want to scale out the backup group, add new servers to the backup group,
The <code>--ha_conf HOST:PORT</code> option should be used, where <code>HOST</code> can be the IP address of any server already in this backup group,
And <code>PORT</code> is its RPC port. E.g:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This command will start a TuGraph server in high availability mode and try to add it to the backup group containing the server <code>172.22.224.15:9090</code>.
Note that joining a backup group requires a server to synchronize its data with the backup group&#x27;s <code>leader</code> server, and this process may take a considerable amount of time, depending on the size of the data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6stopping-the-server">6.Stopping the Server<a href="#6stopping-the-server" class="hash-link" aria-label="Direct link to 6.Stopping the Server" title="Direct link to 6.Stopping the Server">​</a></h2>
<p>When a server goes offline via &#x27;CTRL-C&#x27;, it will notify the current &#x27;leader&#x27; server to remove the server from the backup group. If the leader server goes offline, it will pass the leader identity permission to another server before going offline.</p>
<p>If a server is terminated or disconnected from other servers in the backup group, the server is considered a failed node and the leader server will remove it from the backup group after a specified time limit.</p>
<p>If any server leaves the backup group and wishes to rejoin, it must start with the &#x27;--ha_conf {HOST:PORT}&#x27; option, where &#x27;HOST&#x27; is the IP address of a server in the current backup group.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7restarting-the-server">7.Restarting the Server<a href="#7restarting-the-server" class="hash-link" aria-label="Direct link to 7.Restarting the Server" title="Direct link to 7.Restarting the Server">​</a></h2>
<p>Restarting the entire backup group is not recommended as it disrupts service. All servers can be shut down if desired. But on reboot,
It must be ensured that at least N/2+1 servers in the backup group at shutdown can start normally, otherwise the startup will fail. and,
Regardless of whether <code>enable_bootstrap</code> is specified as true when initially starting the replication group, restarting the server only needs to pass
Specify the <code>--ha_conf host1:port1,host2:port2</code> parameter to restart all servers at once. The command example is as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./lgraph_server -c lgraph.json --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8docker-deploys-a-highly-available-cluster">8.docker deploys a highly available cluster<a href="#8docker-deploys-a-highly-available-cluster" class="hash-link" aria-label="Direct link to 8.docker deploys a highly available cluster" title="Direct link to 8.docker deploys a highly available cluster">​</a></h2>
<p>In real business scenarios, it is likely to encounter the need to deploy high-availability clusters on multiple operating systems or architectures.
Differentiated environments may cause some dependencies to be missing when compiling TuGraph. therefore,
Compiling software in docker and deploying high-availability clusters is very valuable. Take the centos7 version of docker as an example,
The steps to deploy a highly available cluster are as follows.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="81install-mirror">8.1.Install mirror<a href="#81install-mirror" class="hash-link" aria-label="Direct link to 8.1.Install mirror" title="Direct link to 8.1.Install mirror">​</a></h3>
<p>Use the following command to download TuGraph&#x27;s compiled docker image environment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull tugraph/tugraph-compile-centos7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then pull the TuGraph source code and compile and install</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="82create-container">8.2.Create container<a href="#82create-container" class="hash-link" aria-label="Direct link to 8.2.Create container" title="Direct link to 8.2.Create container">​</a></h3>
<p>Use the following command to create a container, use <code>--net=host</code> to make the container run in host mode, in this mode
Docker and the host machine share the network namespace, that is, they share the same IP.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --net=host -itd -p -v {src_dir}:{dst_dir} --name tugraph_ha tugraph/tugraph-compile-centos7 /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="83start-service">8.3.Start service<a href="#83start-service" class="hash-link" aria-label="Direct link to 8.3.Start service" title="Direct link to 8.3.Start service">​</a></h3>
<p>Use the following command to start the service on each server, because docker and the host share IP, so you can directly specify to start the service on the host IP</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lgraph_server -c lgraph.json --host 172.22.224.15 --rpc_port 9090 --enable_ha true --ha_conf 172.22.224.15:9090,172.22.224.16:9090,172.22.224.17:9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9server-status">9.Server Status<a href="#9server-status" class="hash-link" aria-label="Direct link to 9.Server Status" title="Direct link to 9.Server Status">​</a></h2>
<p>The current status of the backup group can be obtained from the TuGraph visualization tool, REST API, and Cypher query.</p>
<p>In the TuGraph visualization tool, you can find the list of servers and their roles in the backup group in the DBInfo section.</p>
<p>With the REST API, you can use <code>GET /info/peers</code> to request information.</p>
<p>In Cypher, the <code>CALL dbms.listServers()</code> statement is used to query the status information of the current backup group.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="10data-synchronization-in-high-availability-mode">10.Data synchronization in high availability mode<a href="#10data-synchronization-in-high-availability-mode" class="hash-link" aria-label="Direct link to 10.Data synchronization in high availability mode" title="Direct link to 10.Data synchronization in high availability mode">​</a></h2>
<p>In high availability mode, different servers in the same backup group may not always be in the same state. For performance reasons, if a request has been synchronized to more than half of the servers, the leader server will consider the request to be in the committed state. Although the rest of the servers will eventually receive the new request, the inconsistent state of the servers will persist for some time. A client may also send a request to a server that has just restarted, thus having an older state and waiting to join a backup group.</p>
<p>To ensure that the client sees consistently continuous data, and in particular to get rid of the &#x27;reverse time travel&#x27; problem, where the client reads a state older than it has seen before, each TuGraph server keeps a monotonically increasing data version number. The mapping of the data version number to the database state in the backup group is globally consistent, meaning that if two servers have the same data version number, they must have the same data. When responding to a request, the server includes its data version number in the response. Thus, the client can tell which version it has seen. The client can choose to send this data version number along with the request. Upon receiving a request with a data version number, the server compares the data version number to its current version and rejects the request if its own version is lower than the requested version. This mechanism ensures that the client never reads a state that is older than before.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/tugraph-db/en-US/en/4.5.1/installation&amp;running/tugraph-running"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tugraph Running</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tugraph-db/en-US/en/4.5.1/utility-tools/data-import"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data Importing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1theory" class="table-of-contents__link toc-highlight">1.Theory</a></li><li><a href="#2preparation" class="table-of-contents__link toc-highlight">2.Preparation</a></li><li><a href="#3start-the-initial-backup-group" class="table-of-contents__link toc-highlight">3.Start the initial backup group</a><ul><li><a href="#31the-initial-data-is-consistent" class="table-of-contents__link toc-highlight">3.1.The initial data is consistent</a></li><li><a href="#32inconsistent-initial-data" class="table-of-contents__link toc-highlight">3.2.Inconsistent initial data</a></li></ul></li><li><a href="#4start-witness-node" class="table-of-contents__link toc-highlight">4.Start witness node</a><ul><li><a href="#41-witness-nodes-are-not-allowed-to-become-leader" class="table-of-contents__link toc-highlight">4.1. Witness nodes are not allowed to become leader</a></li><li><a href="#41-allow-witness-nodes-to-become-leaders" class="table-of-contents__link toc-highlight">4.1. Allow witness nodes to become leaders</a></li></ul></li><li><a href="#5scale-out-other-servers" class="table-of-contents__link toc-highlight">5.Scale out other servers</a></li><li><a href="#6stopping-the-server" class="table-of-contents__link toc-highlight">6.Stopping the Server</a></li><li><a href="#7restarting-the-server" class="table-of-contents__link toc-highlight">7.Restarting the Server</a></li><li><a href="#8docker-deploys-a-highly-available-cluster" class="table-of-contents__link toc-highlight">8.docker deploys a highly available cluster</a><ul><li><a href="#81install-mirror" class="table-of-contents__link toc-highlight">8.1.Install mirror</a></li><li><a href="#82create-container" class="table-of-contents__link toc-highlight">8.2.Create container</a></li><li><a href="#83start-service" class="table-of-contents__link toc-highlight">8.3.Start service</a></li></ul></li><li><a href="#9server-status" class="table-of-contents__link toc-highlight">9.Server Status</a></li><li><a href="#10data-synchronization-in-high-availability-mode" class="table-of-contents__link toc-highlight">10.Data synchronization in high availability mode</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>