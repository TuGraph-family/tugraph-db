<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-4-5-1_en docs-version-current docs-doc-page docs-doc-id-olap&procedure/olap/python-api" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Python Olap API | TuGraph 文档中心</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tugraph.tech/tugraph-db/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tugraph.tech/tugraph-db/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tugraph.tech/tugraph-db/en/4.5.1/olap&amp;procedure/olap/python-api"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-4-5-1_en-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-4-5-1_en-current"><meta data-rh="true" property="og:title" content="Python Olap API | TuGraph 文档中心"><meta data-rh="true" name="description" content="This document mainly introduces the API usage of OlapBase OlapOnDB and OlapOnDisk in Python"><meta data-rh="true" property="og:description" content="This document mainly introduces the API usage of OlapBase OlapOnDB and OlapOnDisk in Python"><link data-rh="true" rel="icon" href="https://mdn.alipayobjects.com/huamei_qcdryc/afts/img/A*AbamQ5lxv0IAAAAAAAAAAAAADgOBAQ/original"><link data-rh="true" rel="canonical" href="https://tugraph.tech/tugraph-db/en/4.5.1/olap&amp;procedure/olap/python-api"><link data-rh="true" rel="alternate" href="https://tugraph.tech/tugraph-db/en/4.5.1/olap&amp;procedure/olap/python-api" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://tugraph.tech/tugraph-db/en-US/en/4.5.1/olap&amp;procedure/olap/python-api" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://tugraph.tech/tugraph-db/en/4.5.1/olap&amp;procedure/olap/python-api" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DGYVABHR0M-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="TuGraph 文档中心" href="/tugraph-db/opensearch.xml">

















<meta name="algolia-site-verification" content="FC204AA054194DE3"><link rel="stylesheet" href="/tugraph-db/assets/css/styles.ce6a6631.css">
<script src="/tugraph-db/assets/js/runtime~main.349d6fd9.js" defer="defer"></script>
<script src="/tugraph-db/assets/js/main.27a83fc4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tugraph-db/"><div class="navbar__logo"><img src="https://mdn.alipayobjects.com/huamei_qcdryc/afts/img/A*AbamQ5lxv0IAAAAAAAAAAAAADgOBAQ/original" alt="Tugraph Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://mdn.alipayobjects.com/huamei_qcdryc/afts/img/A*AbamQ5lxv0IAAAAAAAAAAAAADgOBAQ/original" alt="Tugraph Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/TuGraph-family/tugraph-db" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="docsearch-wrapper" style="display:flex;justify-content:center;flex-direction:column"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div class="itemWrapper"><div class="titleBlock"><span class="titleText">TuGraph DB</span><div class="downIcon"></div></div><div class="contentArea"><span id="engineDescription">Community</span><span class="versionLabel">V<!-- -->4.5.1</span></div></div><div class="searchWrapper"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tugraph-db/en/4.5.1/guide">Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/introduction/what-is-graph">introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/quick-start/preparation">quick-start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/user-guide/tugraph-browser">user-guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/installation&amp;running/environment">installation&amp;running</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/utility-tools/data-import">utility-tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/client-tools/python-client">client-tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/query/cypher">query</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/tugraph-db/en/4.5.1/olap&amp;procedure/procedure">olap&amp;procedure</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/procedure">TuGraph Stored Procedure Guide</a><button aria-label="展开侧边栏分类 &#x27;TuGraph Stored Procedure Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/tutorial">olap</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/tutorial">Bootstrap program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/olap-base-api">OlapBase API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/olap-on-db-api">OlapOnDB API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/olap-on-disk-api">OlapOnDisk API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/python-api">Python Olap API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/algorithms">TuGraph Built-in Algorithm Description</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/tugraph-db/en/4.5.1/olap&amp;procedure/learn/tutorial">learn</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/permission/privilege">permission</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/quality/unit-testing">quality</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/contributor-manual/contributing">contributor-manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tugraph-db/en/4.5.1/best-practices/rdbms-to-tugraph">best-practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tugraph-db/en/4.5.1/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tugraph-db/en/4.5.1/contacts">Contacts</a></li></ul></nav></div></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/tugraph-db/en/4.5.1/guide"><div style="color:#1a1b2572">Docs</div></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">olap&amp;procedure</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">olap</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Python Olap API</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Python Olap API</h1></header>
<blockquote>
<p>This document mainly introduces the API usage of OlapBase OlapOnDB and OlapOnDisk in Python</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of contents<a href="#table-of-contents" class="hash-link" aria-label="Table of contents的直接链接" title="Table of contents的直接链接">​</a></h2>
<ul>
<li><a href="#1-overview">1.Overview</a></li>
<li><a href="#2-configuration-requirements">2.Configuration Requirements</a></li>
<li><a href="#3-cython">3.Cython</a></li>
<li><a href="#4-olap-api">4.Olap API</a>
<ul>
<li><a href="#atomic-operations">4.1. Atomic operations</a></li>
<li><a href="#vertex-collection-class-parallelbitset">4.2. Vertex collection class ParallelBitset</a></li>
<li><a href="#vertex-array-class-parallelvector">4.3. Vertex array class ParallelVector</a></li>
<li><a href="#custom-data-structure">4.4. Custom data structure</a></li>
<li><a href="#graph-class-olapbase">4.5.Graph class OlapBase</a></li>
<li><a href="#graph-class-olapondb">4.6. Graph Class OlapOnDB</a></li>
<li><a href="#graph-class-olapondisk">4.7.Graph class OlapOnDisk</a></li>
</ul>
</li>
<li><a href="#5-lgraph_db-api">5.lgraph DB API</a></li>
<li><a href="#6-algorithm-plug-in-example">6.Algorithm plugin example</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-overview">1 Overview<a href="#1-overview" class="hash-link" aria-label="1 Overview的直接链接" title="1 Overview的直接链接">​</a></h2>
<p>This manual will introduce the simple configuration required to use the Python interface of the TuGraph graph computing system, and explain the TuGraph Python API in conjunction with the code. For details about the functions of class ParallelBitset, OlapBase, etc., see olap-base-api.md, olap-on-db-api.md and olap-on-disk-api.md.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-configuration-requirements">2. Configuration requirements<a href="#2-configuration-requirements" class="hash-link" aria-label="2. Configuration requirements的直接链接" title="2. Configuration requirements的直接链接">​</a></h2>
<p>If you want to use TuGraph to write and compile your own applications, the required configuration requirements are:</p>
<ul>
<li>Linux operating system, currently running successfully on Ubuntu16.04.2 and Centos7 systems.</li>
<li>A compiler that supports C++17 requires GCC version 5.4.1 or later.</li>
<li>Cython, version 3.0a1 or above is required, and the tested version is 3.0.0a11</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-cython">3. Cython<a href="#3-cython" class="hash-link" aria-label="3. Cython的 直接链接" title="3. Cython的直接链接">​</a></h2>
<p>Cython is an efficient programming language that is a superset of Python. Cython can translate .py files into C/C++ codes and compile them into Python extension modules, which can be called through import in Python. In TuGraph, all Python procedures are compiled into Python extension modules by Cython and then used.</p>
<p>The main advantage of using Cython is that it combines the simplicity and ease of use of Python with the performance of C/C++. The TuGraph Python interface is implemented using Cython.</p>
<p><a href="https://cython.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">Cython Documentation</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-olap-api">4. Olap API<a href="#4-olap-api" class="hash-link" aria-label="4. Olap API的直接链接" title="4. Olap API的直接链接">​</a></h2>
<p>The Olap API is used for graph computing and is implemented in C++. The usage and functions are basically the same as the C++ interface. To use the API in a Python file, the interfaces declared in procedures/algo_cython/olap_base.pxd must be imported using <code>cython.cimports.olap_base import *</code>. The Python file can only be run after being compiled by Cython.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="atomic-operations">Atomic operations<a href="#atomic-operations" class="hash-link" aria-label="Atomic operations的直接链接" title="Atomic operations的直接链接">​</a></h3>
<ul>
<li><code>cas[T](ptr: cython.pointer(T), oldv: T, newv: T)-&gt; cython.bint</code>: If the value pointed to by ptr is equal to oldv, assign the value pointed to by ptr to newv and return True, otherwise return False.</li>
<li><code>write_min[T](a: cython.pointer(T), b: T)-&gt;cython.bint</code>: If b is smaller than the value pointed to by a, then assign the value pointed to by a to b and return true, otherwise return false.</li>
<li><code>write_max[T](a: cython.pointer(T), b: T)-&gt;cython.bint</code>: If b is greater than the value pointed to by a, then assign the value pointed to by a to b and return true, otherwise return false.</li>
<li><code>write_add[T](a: cython.pointer(T), b: T)-&gt;cython.bint</code>: Add the value of b to the value pointed to by a.</li>
<li><code>write_sub[T](a: cython.pointer(T), b: T)-&gt;cython.bint</code>: Subtract the value pointed to by a from the value of b.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertex-collection-class-parallelbitset">Vertex collection class ParallelBitset<a href="#vertex-collection-class-parallelbitset" class="hash-link" aria-label="Vertex collection class ParallelBitset的直接链接" title="Vertex collection class ParallelBitset的直接链接">​</a></h3>
<ul>
<li><code>Size() -&gt; size_t</code>: Indicates the number of vertices in the Bitmap.</li>
<li><code>ParallelBitset(size: size_t)</code>: Initializes size and data, where the length of data is (size &gt;&gt; 6) + 1.</li>
<li><code>Clear() -&gt; cython.void</code>: Empties the collection.</li>
<li><code>Fill() -&gt; cython.void</code>: Adds all vertices to the set.</li>
<li><code>Has(i: size_t) -&gt; cython.bint</code>: Checks if vertex i is in the set.</li>
<li><code>Add(i: size_t) -&gt; cython.bint</code>: Adds vertex i to the set.</li>
<li><code>Swap(other: ParallelBitset) -&gt; cython.void</code>: Exchanges elements with another ParallelBitset set.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertex-array-class-parallelvector">Vertex array class ParallelVector<a href="#vertex-array-class-parallelvector" class="hash-link" aria-label="Vertex array class ParallelVector的直接链接" title="Vertex array class ParallelVector的直接链接">​</a></h3>
<ul>
<li><code>ParallelVector[T](size_t capacity)</code>: Constructs a ParallelVector, where capacity is the initial capacity of the vertex array.</li>
<li><code>operator[](i: size_t) -&gt; T</code>: Returns the data at index i.</li>
<li><code>begin() -&gt; cython.pointer(T)</code>: Returns the start pointer of ParallelVector.</li>
<li><code>end() -&gt; cython.pointer(T)</code>: Returns the end pointer of ParallelVector. The usage of begin() and end() is similar to the begin and end pointers of the vector container, and these two pointers can be used to sequentially access the array.</li>
<li><code>Back() -&gt; T</code>: Returns the last data of ParallelVector.</li>
<li><code>Data() -&gt; cython.pointer(T)</code>: Indicates the data of the array itself.</li>
<li><code>Destroy() -&gt; cython.void</code>: Clears the data in the ParallelVector array and deletes the array.</li>
<li><code>Size() -&gt; size_t</code>: Indicates the number of data in ParallelVector.</li>
<li><code>Resize(size: size_t) -&gt; cython.void</code>: Changes ParallelVector to size, which should be greater than or equal to the size before the change and less than capacity.</li>
<li><code>Clear() -&gt; cython.void</code>: Clears the data in ParallelVector.</li>
<li><code>ReAlloc(capacity: size_t) -&gt; cython.void</code>: Allocates a new capacity size to ParallelVector. If the array has data, it migrates the data to the new memory.</li>
<li><code>Fill(elem: T) -&gt; cython.void</code>: Assigns elem to all data of ParallelVector.</li>
<li><code>Append(elem: T, atomic: cython.bint = true) -&gt; cython.void</code>: Adds a data to the end of ParallelVector.</li>
<li><code>Swap(other: ParallelVector[T]) -&gt; cython.void</code>: Exchanges data with another ParallelVector.</li>
<li><code>Copy() -&gt; ParallelVector[T]</code>: Copies the current ParallelVector data and stores it in the copy array.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="custom-data-structure">Custom Data Structure<a href="#custom-data-structure" class="hash-link" aria-label="Custom Data Structure的直接链接" title="Custom Data Structure的直接链接">​</a></h3>
<ul>
<li><code>Empty</code>: A special data type whose content is empty.</li>
<li><code>EdgeUnit[EdgeData]</code>: Indicates the edge whose weight type is EdgeData, used to parse the input file, including three member variables:
<ul>
<li><code>src: size_t</code>: starting vertex of the edge</li>
<li><code>dst: size_t</code>: end of the edge</li>
<li><code>edge_data: EdgeData</code>: edge weight</li>
</ul>
</li>
<li><code>AdjUnit[EdgeData]</code>: indicates the edge whose weight type is EdgeData, which is used in the batch calculation process and contains two member variables:
<ul>
<li><code>neighbor: size_t</code>: neighbor vertex of the edge</li>
<li><code>edge_data: EdgeData</code>: edge weight</li>
</ul>
</li>
<li><code>AdjList[EdgeData]</code>: The adjacency list of vertices whose weight type is EdgeData, often used to represent the set of incoming and outgoing edges of vertices, including three member functions:
<ul>
<li><code>begin()-&gt;cython.pointer(AdjUnit[T])</code>: the starting pointer of the list</li>
<li><code>end()-&gt;cython.pointer(AdjUnit[T])</code>: the end pointer of the list</li>
<li><code>operator[](i: size_t)-&gt; AdjUnit[EdgeData]</code>: the data whose subscript is i</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-class-olapbase">Graph class OlapBase<a href="#graph-class-olapbase" class="hash-link" aria-label="Graph class OlapBase的直接链接" title="Graph class OlapBase的直接链接">​</a></h3>
<ul>
<li>
<p><code>NumVertices()-&gt;size_t</code>: get the number of vertices</p>
</li>
<li>
<p><code>NumEdges()-&gt; size_t</code>: get the number of edges</p>
</li>
<li>
<p><code>OutDegree(vid: size_t)-&gt; size_t</code>: out-degree of vertex vid</p>
</li>
<li>
<p><code>InDegree(vid: size_t)-&gt;size_t</code>: in-degree of the vertex vid</p>
</li>
<li>
<p><code>AllocVertexArray[VertexData]() -&gt;ParallelVector[VertexData]</code>: Allocates an array of type VertexData with size as the number of vertices</p>
</li>
<li>
<p><code>AllocVertexSubset()-&gt; ParallelBitset</code>: Assigns a subset of ParallelBitsets to denote whether the state of all vertices is activated</p>
</li>
<li>
<p><code>OutEdges(vid: size_t)-&gt; AdjList[EdgeData]</code>: Get the list of all outgoing edges of vertex v</p>
</li>
<li>
<p><code>InEdges(vid: size_t)-&gt; AdjList[EdgeData]</code>: Get the list of all incoming edges of vertex v</p>
</li>
<li>
<p><code>Transpose()-&gt;cython.void</code>: transpose of a directed graph</p>
</li>
<li>
<p><code>LoadFromArray(edge_array: cython.p_char, input_vertices: size_t, input_edges: size_t, edge_direction_policy: EdgeDirectionPolicy)</code>: Loads the graph data from the array, contains four parameters, the meaning of which are respectively:</p>
<ul>
<li>
<p><code>edge_array</code> : reads the data from the array into the graph. Normally, the array contains multiple edges.</p>
</li>
<li>
<p><code>input_vertices</code>: specifies the number of vertices read into the graph by the array.</p>
</li>
<li>
<p><code>input_edges</code> : specifies the number of edges that the array reads into the image.</p>
</li>
<li>
<p><code>edge_direction_policy</code> : indicates that the graph is directed or undirected. The graph can be divided into three modes: DUAL_DIRECTION, MAKE_SYMMETRIC, and INPUT_SYMMETRIC. For details, see &#x27;enum EdgeDirectionPolicy&#x27; in the config.h file in the core folder.</p>
</li>
</ul>
</li>
<li>
<p><code>AcquireVertexLock(vid: size_t)-&gt; cython.void</code>: locks a vertex vid and prohibits other threads from accessing the vertex data corresponding to this lock</p>
</li>
<li>
<p><code>void ReleaseVertexLock(vid: size_t)-&gt; cython.void</code>: unlocks the vertex vid and all threads can access the vertex data corresponding to the lock</p>
</li>
</ul>
<p>TuGraph provides two batch operations to perform point-centric batch processing in parallel, which is slightly different from C++ in Python.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Function name: ProcessVertexInRange[ReducedSum, Algorithm](</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># work: (algo: Algorithm, vi: size_t)-&gt; ReducedSum,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># lower: size_t, upper: size_t,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># algo: Algorithm,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># zero: ReducedSum = 0,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># reduce: (a: ReducedSum, b: ReducedSum)-&gt; ReducedSum = reduce_plus[ReducedSum])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Function purpose: Executes the work function on nodes whose node numbers are between lower and upper in the Graph. The fourth parameter indicates the base of accumulation, which is 0 by default.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The fifth parameter indicates that the iterative reduce function operation is performed on the node return value after each work process, and the default is the accumulation operation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># For specific implementation, please refer to the specific code in include/lgraph/olap_base.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example usage: Count the number of vertices with edges in the parent array.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cython</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cimports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">olap_base </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cclass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CountCore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    graph</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OlapBase</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ParallelVector</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cfunc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">nogil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Work</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OutDegree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vi</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pointer_g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OlapBase</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pointer_g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AllocVertexArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vertex_num</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vertex_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessVertexInRange</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CountCore</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Work</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;the number is&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vertex_num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count_core </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CountCore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count_core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>g is the instantiated object of graph class OlapBase</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Function name: ProcessVertexActive[ReducedSum, Algorithm](</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># work: (algo: Algorithm, vi: size_t)-&gt; ReducedSum,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># active: ParallelBitset,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># algo: Algorithm,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># zero: ReducedSum = 0,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># reduce: (a: ReducedSum, b: ReducedSum)-&gt; ReducedSum = reduce_plus[ReducedSum])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Function purpose: Execute the work function on the nodes corresponding to 1 in the active_vertices bitset. The third parameter indicates the base of accumulation, which is 0 by default;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The fourth parameter indicates that the iterative reduce function operation is performed on the node return value after each work process, and the default is the accumulation operation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># For specific implementation, please refer to the specific code in /include/lgraph/olap_base.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Usage example: Output all out-degree neighbors of nodes 1, 2, and 3 in the Graph, and count the total out-degree of these three nodes.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cython</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cimports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">olap_base </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cimports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">libc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdio </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cclass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">NeighborCore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    graph</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OlapBase</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active_in</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ParallelBitset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cfunc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">nogil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Work</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        degree </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> OutDegree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dst</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        edges </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> OutEdges</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        local_out_degree</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">degree</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dst </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> edges</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">neighbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;node %lu has neighbor %lu\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            local_out_degree </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> local_out_degree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pointer_g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OlapBase</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pointer_g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_in </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AllocVertexSubset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        total_outdegree </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessVertexActive</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CountCore</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Work</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_in</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;total outdegree of node1,2,3 is %lu\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">total_outdegree</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    neighbor_core </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NeighborCore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    neighbor_core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As shown in the above two examples, ProcessVertexActive and ProcessVertexInRange in Python require an additional algorithm class pointer parameter compared to their C++ counterparts. The Work function is generally used as a member function of the algorithm class to access member variables, such as in the graph and ParallelVector parent examples shown above. When calling the batch function, the Work function and the self pointer of the algorithm class are passed to the batch function.</p>
<p>The Work function will be called in multiple threads, so the @cython.nogil decorator is added to release the Python global interpretation lock. In code executed by multiple threads, such as the Work function in the batch function, variables are better declared as C/C++ types using <code>dst: type</code> or <code>dst = cython.declare(type)</code>. This is because Python objects cannot be used in multi-threaded code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-class-olapondb">Graph class OlapOnDB:<a href="#graph-class-olapondb" class="hash-link" aria-label="Graph class OlapOnDB:的直接链接" title="Graph class OlapOnDB:的直接链接">​</a></h3>
<p>Parallelize to create a directed graph:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">olapondb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OlapOnDB</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> txn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SNAPSHOT_PARALLEL</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Parallelize to create an undirected graph</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">olapondb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OlapOnDB</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> txn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SNAPSHOT_PARALLEL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SNAPSHOT_UNDIRECTED</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ID_MAPPING creates a directed graph</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">olapondb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OlapOnDB</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> txn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SNAPSHOT_PARALLEL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SNAPSHOT_IDMAPPING</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-class-olapondisk">Graph class OlapOnDisk<a href="#graph-class-olapondisk" class="hash-link" aria-label="Graph class OlapOnDisk的直接链接" title="Graph class OlapOnDisk的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configbase">ConfigBase:<a href="#configbase" class="hash-link" aria-label="ConfigBase:的直接链接" title="ConfigBase:的直接链接">​</a></h4>
<ul>
<li>
<p><code>ConfigBase()</code>: Constructor</p>
</li>
<li>
<p><code>std::string input_dir</code>: graph edge table data path</p>
</li>
<li>
<p><code>std::string output_dir</code>: output path</p>
</li>
<li>
<p><code>Load(config: ConfigBase[EdgeData], edge_direction_policy: EdgeDirectionPolicy)-&gt; void</code>: read in graph data</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-lgraph_db-api">5. lgraph_db API<a href="#5-lgraph_db-api" class="hash-link" aria-label="5. lgraph_db API的直接链接" title="5. lgraph_db API的直接链接">​</a></h2>
<p>Please refer to the files procedures/algo_cython/lgraph_db.pxd and lgraph_db_python.py for the lgraph_db API.</p>
<p>The usage and functions of the interface in lgraph_db.pxd are basically the same as the C++ interface. The interface declared in lgraph_db.pxd is implemented in C++. In the py file, it must be imported by <code>cython.cimports.olap_db import *</code> and compiled by the Cython file to run.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertexindexiterator">VertexIndexIterator<a href="#vertexindexiterator" class="hash-link" aria-label="VertexIndexIterator的直接链接" title="VertexIndexIterator的直接链接">​</a></h3>
<ul>
<li><code>GetVid()-&gt; int64_t</code>: Get the vid of the vertex</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="galaxy">Galaxy<a href="#galaxy" class="hash-link" aria-label="Galaxy的直接链接" title="Galaxy的直接链接">​</a></h3>
<ul>
<li><code>Galaxy(dir_path: std::string)</code>: constructor, dir_path is the db path</li>
<li><code>SetCurrentUser(user: std::string, password: std::string)-&gt; cython.void</code>: set user</li>
<li><code>SetUser(user: std::string)-&gt; cython.void</code>: set user</li>
<li><code>OpenGraph(graph: std::string, read_only: bint)-&gt; GraphDB</code>: create GraphDB</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphdb">GraphDB:<a href="#graphdb" class="hash-link" aria-label="GraphDB:的直接链接" title="GraphDB:的直接链接">​</a></h3>
<ul>
<li><code>CreateReadTxn()-&gt; Transaction</code>: create a read-only transaction</li>
<li><code>CreateWriteTxn()-&gt; Transaction</code>: create a write transaction</li>
<li><code>ForkTxn(txn: Transaction)-&gt; Transaction</code>: Copy transactions, only read transactions can be copied</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction">Transaction:<a href="#transaction" class="hash-link" aria-label="Transaction:的直接链接" title="Transaction:的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GetVertexIndexIterator(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 label: std::string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 field: std::string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 key_start: std::string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 key_end: std::string) -&gt; VertexIndexIterator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Gets index iterator. The iterator has field value [key_start, key_end]. So key_start=key_end=v returns an iterator pointing to all vertexes that has field value v</p>
<p>lgraph_db_python.py packages the C++ classes Galaxy and GraphDB from lgraph_db.pxd as Python classes. After compiling lgraph_db_python.py into a Python extension, you can directly access it in a Python file or from the Python command line by importing it with <code>import lgraph_db_python</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pygalaxy">PyGalaxy:<a href="#pygalaxy" class="hash-link" aria-label="PyGalaxy:的直接链接" title="PyGalaxy:的直接链接">​</a></h3>
<ul>
<li><code>PyGalaxy(self, dir_path: str)</code>: constructor, dir_path is the db path</li>
<li><code>SetCurrentUser(self, user: str password: str)-&gt; void</code>: set user</li>
<li><code>SetUser(self, user: std::string)-&gt; void</code>: set user</li>
<li><code>OpenGraph(self, graph: str, read_only: bool)-&gt; PyGraphDB</code>: create PyGraphDB</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pygraphdb">PyGraphDB:<a href="#pygraphdb" class="hash-link" aria-label="PyGraphDB:的直接链接" title="PyGraphDB:的直接链接">​</a></h3>
<ul>
<li><code>get_pointer(self)-&gt;cython.Py_ssize_t</code>: address of C++ class GraphDB</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-algorithm-plug-in-example">6. Algorithm plug-in example<a href="#6-algorithm-plug-in-example" class="hash-link" aria-label="6. Algorithm plug-in example的直接链接" title="6. Algorithm plug-in example的直接链接">​</a></h2>
<p>The following is a code example of the BFS algorithm implemented in Python:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># cython: language_level=3, cpp_locals=True, boundscheck=False, wraparound=False, initializedcheck=False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># distutils: language = c++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Comments work as follows:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># language_level=3: use Python3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cpp_locals=True: C++17 is required, and std::optional is used to manage C++ objects in Python code, which can avoid copy construction of C++ objects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># boundscheck=False: Turn off bounds checking for indexes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># wraparound=False: Turn off the processing of negative subscripts (similar to Python List)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># initializedcheck=False: Turn off checking whether the memory is initialized, and the running performance will be faster after turning off the check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># language = c++: translate this .py file to C++ instead of C file. TuGraph uses a lot of template functions, so C++ should be used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cython</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cimports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">olap_base </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cimports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lgraph_db </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># From procedures/algo_cython/ cimportolap_base.pxd and lgraph_db.pxd, similar to #include &quot;xxx.h&quot; in C++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cimports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">libc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdio </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Similar to #include &lt;stdio.h&gt; in C++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Other common ones include cython.cimports.libcpp.unordered_map, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cclass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cython.cclass indicates that BFSCore is a C-type Class</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">BFSCore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    graph</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OlapBase</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cython.pointer(OlapBase[Empty]) indicates the pointer of OlapBase[Empty], similar to OlapBase[Empty]* in C++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Cython provides common types of pointers, such as cython.p_int, cython.p_char, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ParallelVector</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active_in</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ParallelBitset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active_out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ParallelBitset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># root: size_t declares root as a C++ size_t type variable, equivalent to root = cython.declare(size_t)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Variables that do not declare a type are Python object types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Declaring variable types will greatly improve performance, and in the multi-threaded part, only C/C++ type variables can be accessed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cfunc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cython.cfunc indicates that Work is a C-type function, and the parameters and return values should be declared</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cfunc has good performance and can accept C/C++ objects as parameters and return values, but it cannot be called in other python files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Similar to cython.ccall, such as Standalone function, which can be called in other python files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">nogil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cython.nogil means to release the Python global interpretation lock. In the part modified by nogil, Python objects cannot be accessed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># In the multi-threaded part, there should be nogil decorator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">exceptval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cython.exceptval(check=False) means that exception propagation is disabled, and Python exceptions raised inside the function will be ignored</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Work</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        degree </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OutDegree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        out_edges </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">AdjList</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OutEdges</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        local_num_activations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dst</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">degree</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dst </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> out_edges</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">neighbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dst</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># parent[dst] == -1 means that dst has not been visited by bfs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic"># Set dst as an active node; ParallelBitmap.Add is an atomic operation to prevent double calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dst</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    local_num_activations </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> local_num_activations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cfunc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">nogil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">exceptval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OlapBase</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> size_t</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> graph </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_in </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AllocVertexSubset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AllocVertexSubset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AllocVertexArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_vertices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NumVertices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;num_vertices = %lu\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num_vertices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_activations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        discovered_vertices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num_activations</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> num_activations </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            num_activations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessVertexActive</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BFSCore</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Work</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_in</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            discovered_vertices </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> num_activations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Swap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> active_in</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;num_activations = %lu\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num_activations</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> discovered_vertices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">cfunc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">procedure_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GraphDB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;node&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    field </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;label&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;label&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;field&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;field&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    txn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateReadTxn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    olapondb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OlapOnDB</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Empty</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> txn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SNAPSHOT_PARALLEL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Create OlapOnDB in parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Cython does not support dereference operations such as *db, use db[0] to dereference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root_vid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> txn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GetVertexIndexIterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        label</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> field</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root_id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> root_id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GetVid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Get the iterator of the root node through GetVertexIndexIterator based on the root node label name, field name and field value (root_id),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># and get the vid through the iterator. When there is no ID_MAPPING, the vid is the same as the id in OlapOnDB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> cost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;prepare_cost = %lf s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">double</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BFSCore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">olapondb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> root_vid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> cost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;core_cost = %lf s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">double</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;found_vertices&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;num_vertices&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> olapondb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> NumVertices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;num_edges&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> olapondb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> NumEdges</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cython</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">ccall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lgraph_db_python</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PyGraphDB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Process is the plug-in entry in embed mode and procedure mode, modified with cython.ccall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The Process function must be named Process, and the parameters are lgraph_db_python.PyGraphDB and bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The return value must be (bool, str)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _inp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> inp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;utf-8&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_inp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Py_ssize_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Get the address of the GraphDB object in the PyGraphDB, convert it to a pointer and pass it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    procedure_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cython</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pointer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GraphDB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/olap-on-disk-api"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">OlapOnDisk API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tugraph-db/en/4.5.1/olap&amp;procedure/olap/algorithms"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">TuGraph Built-in Algorithm Description</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of contents</a></li><li><a href="#1-overview" class="table-of-contents__link toc-highlight">1 Overview</a></li><li><a href="#2-configuration-requirements" class="table-of-contents__link toc-highlight">2. Configuration requirements</a></li><li><a href="#3-cython" class="table-of-contents__link toc-highlight">3. Cython</a></li><li><a href="#4-olap-api" class="table-of-contents__link toc-highlight">4. Olap API</a><ul><li><a href="#atomic-operations" class="table-of-contents__link toc-highlight">Atomic operations</a></li><li><a href="#vertex-collection-class-parallelbitset" class="table-of-contents__link toc-highlight">Vertex collection class ParallelBitset</a></li><li><a href="#vertex-array-class-parallelvector" class="table-of-contents__link toc-highlight">Vertex array class ParallelVector</a></li><li><a href="#custom-data-structure" class="table-of-contents__link toc-highlight">Custom Data Structure</a></li><li><a href="#graph-class-olapbase" class="table-of-contents__link toc-highlight">Graph class OlapBase</a></li><li><a href="#graph-class-olapondb" class="table-of-contents__link toc-highlight">Graph class OlapOnDB:</a></li><li><a href="#graph-class-olapondisk" class="table-of-contents__link toc-highlight">Graph class OlapOnDisk</a><ul><li><a href="#configbase" class="table-of-contents__link toc-highlight">ConfigBase:</a></li></ul></li></ul></li><li><a href="#5-lgraph_db-api" class="table-of-contents__link toc-highlight">5. lgraph_db API</a><ul><li><a href="#vertexindexiterator" class="table-of-contents__link toc-highlight">VertexIndexIterator</a></li><li><a href="#galaxy" class="table-of-contents__link toc-highlight">Galaxy</a></li><li><a href="#graphdb" class="table-of-contents__link toc-highlight">GraphDB:</a></li><li><a href="#transaction" class="table-of-contents__link toc-highlight">Transaction:</a></li><li><a href="#pygalaxy" class="table-of-contents__link toc-highlight">PyGalaxy:</a></li><li><a href="#pygraphdb" class="table-of-contents__link toc-highlight">PyGraphDB:</a></li></ul></li><li><a href="#6-algorithm-plug-in-example" class="table-of-contents__link toc-highlight">6. Algorithm plug-in example</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>