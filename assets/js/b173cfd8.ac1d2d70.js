"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[35757],{28453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>i});var t=r(96540);const l={},o=t.createContext(l);function d(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),t.createElement(o.Provider,{value:n},e.children)}},71447:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var t=r(74848),l=r(28453);const o={},d="bolt \u9ad8\u53ef\u7528\u96c6\u7fa4\u6a21\u5f0f",i={id:"installation&running/bolt_cluster",title:"bolt \u9ad8\u53ef\u7528\u96c6\u7fa4\u6a21\u5f0f",description:"\u6b64\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u914d\u7f6e\u4e00\u4e2aneo4j bolt\u5ba2\u6237\u7aef\u53ef\u4ee5\u8fde\u63a5\u7684\u96c6\u7fa4\u6a21\u5f0f",source:"@site/versions/version-4.5.2/zh-CN/source/5.installation&running/9.bolt_cluster.md",sourceDirName:"5.installation&running",slug:"/installation&running/bolt_cluster",permalink:"/tugraph-db/zh/4.5.2/installation&running/bolt_cluster",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:9,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u90e8\u7f72\u9ad8\u53ef\u7528\u6a21\u5f0f",permalink:"/tugraph-db/zh/4.5.2/installation&running/high-availability-mode"},next:{title:"bolt \u9ad8\u53ef\u7528\u96c6\u7fa4\u6a21\u5f0f\u5b9e\u8df5",permalink:"/tugraph-db/zh/4.5.2/installation&running/bolt_cluster_practice"}},s={},c=[{value:"\u521b\u5efa3\u8282\u70b9\u96c6\u7fa4",id:"\u521b\u5efa3\u8282\u70b9\u96c6\u7fa4",level:2},{value:"\u8282\u70b91\u914d\u7f6e",id:"\u8282\u70b91\u914d\u7f6e",level:3},{value:"\u8282\u70b92\u914d\u7f6e",id:"\u8282\u70b92\u914d\u7f6e",level:3},{value:"\u8282\u70b93\u914d\u7f6e",id:"\u8282\u70b93\u914d\u7f6e",level:3},{value:"\u914d\u7f6e\u8bf4\u660e",id:"\u914d\u7f6e\u8bf4\u660e",level:3},{value:"\u96c6\u7fa4\u64cd\u4f5c\u8bed\u53e5",id:"\u96c6\u7fa4\u64cd\u4f5c\u8bed\u53e5",level:2},{value:"\u67e5\u770b\u96c6\u7fa4\u6210\u5458\u4fe1\u606f",id:"\u67e5\u770b\u96c6\u7fa4\u6210\u5458\u4fe1\u606f",level:3},{value:"\u67e5\u770b\u8282\u70b9\u7684raft\u72b6\u6001\u4fe1\u606f.",id:"\u67e5\u770b\u8282\u70b9\u7684raft\u72b6\u6001\u4fe1\u606f",level:3},{value:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u5230\u96c6\u7fa4",id:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u5230\u96c6\u7fa4",level:3},{value:"\u6dfb\u52a0\u4e00\u4e2alearner\u8282\u70b9\u5230\u96c6\u7fa4",id:"\u6dfb\u52a0\u4e00\u4e2alearner\u8282\u70b9\u5230\u96c6\u7fa4",level:3},{value:"\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\u4e00\u4e2a\u6210\u5458\u8282\u70b9",id:"\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\u4e00\u4e2a\u6210\u5458\u8282\u70b9",level:3},{value:"bolt\u5ba2\u6237\u7aef\u8fde\u63a5\u5b9e\u4f8b",id:"bolt\u5ba2\u6237\u7aef\u8fde\u63a5\u5b9e\u4f8b",level:2},{value:"python",id:"python",level:3}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"bolt-\u9ad8\u53ef\u7528\u96c6\u7fa4\u6a21\u5f0f",children:"bolt \u9ad8\u53ef\u7528\u96c6\u7fa4\u6a21\u5f0f"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u6b64\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u914d\u7f6e\u4e00\u4e2aneo4j bolt\u5ba2\u6237\u7aef\u53ef\u4ee5\u8fde\u63a5\u7684\u96c6\u7fa4\u6a21\u5f0f"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u521b\u5efa3\u8282\u70b9\u96c6\u7fa4",children:"\u521b\u5efa3\u8282\u70b9\u96c6\u7fa4"}),"\n",(0,t.jsx)(n.h3,{id:"\u8282\u70b91\u914d\u7f6e",children:"\u8282\u70b91\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "host": "127.0.0.1",\n  "port": 7070,\n  "bolt_port":7687,\n  "bolt_raft_port":8000,\n  "bolt_raft_node_id":1,\n  "bolt_raft_init_peers":[\n        {"bolt_raft_node_id":1,"ip":"127.0.0.1","bolt_raft_port":8000,"bolt_port":7687}, \n        {"bolt_raft_node_id":2,"ip":"127.0.0.1","bolt_raft_port":8001,"bolt_port":7688}, \n        {"bolt_raft_node_id":3,"ip":"127.0.0.1","bolt_raft_port":8002,"bolt_port":7689}\n  ],\n  "verbose": 1,\n  "log_dir": "log"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u8282\u70b92\u914d\u7f6e",children:"\u8282\u70b92\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "host": "127.0.0.1",\n  "port": 7070,\n  "bolt_port":7688,\n  "bolt_raft_port":8001,\n  "bolt_raft_node_id":2,\n  "bolt_raft_init_peers":[\n        {"bolt_raft_node_id":1,"ip":"127.0.0.1","bolt_raft_port":8000,"bolt_port":7687}, \n        {"bolt_raft_node_id":2,"ip":"127.0.0.1","bolt_raft_port":8001,"bolt_port":7688}, \n        {"bolt_raft_node_id":3,"ip":"127.0.0.1","bolt_raft_port":8002,"bolt_port":7689}\n  ],\n  "verbose": 1,\n  "log_dir": "log"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u8282\u70b93\u914d\u7f6e",children:"\u8282\u70b93\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "host": "127.0.0.1",\n  "port": 7070,\n  "bolt_port":7689,\n  "bolt_raft_port":8002,\n  "bolt_raft_node_id":3,\n  "bolt_raft_init_peers":[\n        {"bolt_raft_node_id":1,"ip":"127.0.0.1","bolt_raft_port":8000,"bolt_port":7687}, \n        {"bolt_raft_node_id":2,"ip":"127.0.0.1","bolt_raft_port":8001,"bolt_port":7688}, \n        {"bolt_raft_node_id":3,"ip":"127.0.0.1","bolt_raft_port":8002,"bolt_port":7689}\n  ],\n  "verbose": 1,\n  "log_dir": "log"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u7136\u540e\u6b63\u5e38\u542f\u52a8\u4e09\u4e2algraph_server\u5373\u53ef\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u914d\u7f6e\u8bf4\u660e",children:"\u914d\u7f6e\u8bf4\u660e"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"port"}),": web\u7aef\u53e3\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bolt_port"}),": \u5bf9\u5916\u4f7f\u7528\uff0cneo4j bolt\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u7aef\u53e3\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bolt_raft_port"}),": \u96c6\u7fa4\u5185\u90e8\u4f7f\u7528\uff0craft\u96c6\u7fa4\u5185\u90e8\u4e92\u76f8\u901a\u4fe1\u65f6\u6240\u7528\u7684\u7aef\u53e3\uff0cbolt\u5ba2\u6237\u7aef\u4e0d\u8981\u8fde\u63a5\u8fd9\u4e2a\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bolt_raft_node_id"}),": raft\u96c6\u7fa4\u8282\u70b9id\uff0c\u6574\u4e2a\u96c6\u7fa4\u6bcf\u4e2a\u8282\u70b9\u8981\u552f\u4e00\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bolt_raft_init_peers"}),": raft\u96c6\u7fa4\u9996\u6b21\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f7f\u7528\uff0c\u91cc\u9762\u8bb0\u5f55\u4e86\u6bcf\u4e2a\u8282\u70b9\u7684",(0,t.jsx)(n.code,{children:"bolt_raft_node_id"}),", ",(0,t.jsx)(n.code,{children:"ip"}),", ",(0,t.jsx)(n.code,{children:"bolt_raft_port"}),", ",(0,t.jsx)(n.code,{children:"bolt_port"})," \u8fd9\u6837\u6bcf\u4e2a\u8282\u70b9\u90fd\u77e5\u9053\u5176\u4ed6\u8282\u70b9\u7684\u901a\u4fe1\u4fe1\u606f\uff0c\u53ef\u4ee5\u4e92\u76f8\u901a\u4fe1\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["raft\u96c6\u7fa4\u76844\u4e2a\u6838\u5fc3\u914d\u7f6e\u53c2\u6570\u662f",(0,t.jsx)(n.code,{children:"bolt_port"}),",",(0,t.jsx)(n.code,{children:"bolt_raft_port"}),",",(0,t.jsx)(n.code,{children:"bolt_raft_node_id"}),",",(0,t.jsx)(n.code,{children:"bolt_raft_init_peers"}),"\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u96c6\u7fa4\u64cd\u4f5c\u8bed\u53e5",children:"\u96c6\u7fa4\u64cd\u4f5c\u8bed\u53e5"}),"\n",(0,t.jsx)(n.h3,{id:"\u67e5\u770b\u96c6\u7fa4\u6210\u5458\u4fe1\u606f",children:"\u67e5\u770b\u96c6\u7fa4\u6210\u5458\u4fe1\u606f"}),"\n",(0,t.jsx)(n.p,{children:"\u53ef\u4ee5\u5411\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u53d1\u9001\uff0c\u8fd4\u56de\u6210\u5458\u5217\u8868\u4ee5\u53caleader\u4fe1\u606f\u3002"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"CALL db.bolt.listRaftNodes()"})}),"\n",(0,t.jsx)(n.h3,{id:"\u67e5\u770b\u8282\u70b9\u7684raft\u72b6\u6001\u4fe1\u606f",children:"\u67e5\u770b\u8282\u70b9\u7684raft\u72b6\u6001\u4fe1\u606f."}),"\n",(0,t.jsx)(n.p,{children:"\u53ef\u4ee5\u5411\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u53d1\u9001\uff0c\u8fd4\u56de\u6bcf\u4e2a\u8282\u70b9\u81ea\u5df1\u7684raft\u72b6\u6001\u4fe1\u606f\u3002"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"CALL db.bolt.getRaftStatus()"})}),"\n",(0,t.jsx)(n.h3,{id:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u5230\u96c6\u7fa4",children:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u5230\u96c6\u7fa4"}),"\n",(0,t.jsxs)(n.p,{children:["\u6dfb\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u5230\u96c6\u7fa4\uff0c\u8282\u70b9id\u662f",(0,t.jsx)(n.code,{children:"4"}),"\uff0cip\u662f",(0,t.jsx)(n.code,{children:"100.88.118.28"}),", ",(0,t.jsx)(n.code,{children:"bolt_port"}),"\u662f",(0,t.jsx)(n.code,{children:"50003"}),", ",(0,t.jsx)(n.code,{children:"bolt_raft_port"}),"\u662f",(0,t.jsx)(n.code,{children:"60003"}),"\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u53ea\u80fd\u53d1\u9001\u7ed9leader\u8282\u70b9\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CALL db.bolt.addRaftNode(4, '100.88.118.28', 50003, 60003)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u6dfb\u52a0\u4e00\u4e2alearner\u8282\u70b9\u5230\u96c6\u7fa4",children:"\u6dfb\u52a0\u4e00\u4e2alearner\u8282\u70b9\u5230\u96c6\u7fa4"}),"\n",(0,t.jsxs)(n.p,{children:["\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684learner\u8282\u70b9\uff08\u4e0d\u53c2\u4e0e\u9009\u4e3e\u6295\u7968\uff0c\u53ea\u540c\u6b65\u6570\u636e\uff09\uff0c\u8282\u70b9id\u662f",(0,t.jsx)(n.code,{children:"4"}),"\uff0cip\u662f",(0,t.jsx)(n.code,{children:"100.88.118.28"}),", ",(0,t.jsx)(n.code,{children:"bolt_port"}),"\u662f",(0,t.jsx)(n.code,{children:"50003"}),", ",(0,t.jsx)(n.code,{children:"bolt_raft_port"}),"\u662f",(0,t.jsx)(n.code,{children:"60003"}),"\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u53ea\u80fd\u53d1\u9001\u7ed9leader\u8282\u70b9\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CALL db.bolt.addRaftLearnerNode(4, '100.88.118.28', 50003, 60003)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\u4e00\u4e2a\u6210\u5458\u8282\u70b9",children:"\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\u4e00\u4e2a\u6210\u5458\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:["\u5c06\u8282\u70b9id\u662f",(0,t.jsx)(n.code,{children:"4"}),"\u7684\u5b9e\u4f8b\uff0c\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\uff0c\u53ea\u80fd\u53d1\u9001\u7ed9leader\u8282\u70b9\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u53ea\u80fd\u53d1\u9001\u7ed9leader\u8282\u70b9\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CALL db.bolt.removeRaftNode(4)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"bolt\u5ba2\u6237\u7aef\u8fde\u63a5\u5b9e\u4f8b",children:"bolt\u5ba2\u6237\u7aef\u8fde\u63a5\u5b9e\u4f8b"}),"\n",(0,t.jsx)(n.h3,{id:"python",children:"python"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"from neo4j import GraphDatabase\n\ndef custom_resolver(address):\n    if address == ('mycluster.com', 9999):\n        return [\n            ('127.0.0.1', 7687),\n            ('127.0.0.1', 7688),\n            ('127.0.0.1', 7689)\n        ]\n    else:\n        return [address]\n\n\nif __name__ == '__main__':\n    driver = GraphDatabase.driver(\n        \"neo4j://mycluster.com:9999\",\n        auth=(\"admin\", \"73@TuGraph\"),\n        resolver=custom_resolver\n    )\n    session = driver.session(database=\"default\")\n    session.run(\"CALL db.dropDB()\")\n    session.run(\"CALL db.createVertexLabel('person', 'id' , 'id', 'INT32', false, 'count', 'INT64', false)\")\n    session.run(\"create (n1:person {id:1, count:0})\")\n    session.close()\n    driver.close()\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"mycluster.com:9999"}),"\u662f\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u5047\u7684\u57df\u540d\u5730\u5740, GraphDatabase driver\u521d\u59cb\u5316\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4f20\u5165\u4e00\u4e2a\u5b9a\u5236\u5316\u7684resolver\u89e3\u6790\u5668",(0,t.jsx)(n.code,{children:"custom_resolver"}),", ",(0,t.jsx)(n.code,{children:"custom_resolver"}),"\u91cc\u9762\u7684\u903b\u8f91\u662f\u5f53\u57df\u540d\u5730\u5740\u662f",(0,t.jsx)(n.code,{children:"mycluster.com:9999"}),"\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u4e09\u4e2a\u96c6\u7fa4\u5730\u5740"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);